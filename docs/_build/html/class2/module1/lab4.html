<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>2.1.4. Lab 4: Configure A Firewall Policy and Firewall Rules For Each Application</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="2.1.4. Lab 4: Configure A Firewall Policy and Firewall Rules For Each Application"/>
  <meta name="product" content="F5 Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-01-28 09:36:45"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.1.4. Lab 4: Configure A Firewall Policy and Firewall Rules For Each Application &#8212; F5 Firewall Solutions  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.1.5. Lab 5: Provide Firewall Security Policies For CDN Enabled Applications" href="lab5.html" />
    <link rel="prev" title="2.1.3. Lab 3: Configure Local Logging For Firewall Events" href="lab3.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">1. Class 1: AFM – The Data Center Firewall</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class2.html">2. Advanced Multi-Layer Firewall Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">3. Class - F5 BIG-IP DDoS and DNS DoS Protections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">4. Flowmon Integrated Out-of-path DDoS Solution</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">2.1.4. Lab 4: Configure A Firewall Policy and Firewall Rules For Each Application</a><ul>
<li><a class="reference internal" href="#create-the-downloads-policy-firewall-policy-and-rules">2.1.4.1. Create The downloads_policy Firewall Policy And Rules</a></li>
<li><a class="reference internal" href="#assign-the-policy-to-the-virtual-server">2.1.4.2. Assign The Policy To The Virtual Server</a></li>
<li><a class="reference internal" href="#create-a-separate-policy-for-the-api-virtual-server">2.1.4.3. Create A Separate Policy For The API Virtual Server</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Firewall Solutions</a>
              &gt; <a href="../class2.html">2. Advanced Multi-Layer Firewall Protection</a>
              &gt; <a href="module1.html">2.1. Module 1: F5 Multi-layer Firewall</a>

          <span class="right">
             <a href="../../_sources/class2/module1/lab4.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-firewall">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-4-configure-a-firewall-policy-and-firewall-rules-for-each-application">
<h1>2.1.4. Lab 4: Configure A Firewall Policy and Firewall Rules For Each Application<a class="headerlink" href="#lab-4-configure-a-firewall-policy-and-firewall-rules-for-each-application" title="Permalink to this headline">¶</a></h1>
<p>A network firewall policy is a collection of network firewall rules that can be applied to a virtual server. In our lab, we will create two policies, each of which includes two rules. This policy will then be applied to the appropriate virtual servers and tested.</p>
<div class="section" id="create-the-downloads-policy-firewall-policy-and-rules">
<h2>2.1.4.1. Create The downloads_policy Firewall Policy And Rules<a class="headerlink" href="#create-the-downloads-policy-firewall-policy-and-rules" title="Permalink to this headline">¶</a></h2>
<p>This example provides a firewall policy to the <strong>www.mysite.com/downloads</strong> portion of the application. A real world example of this would be with companies hosting cryptographic software which is subject to export restrictions. In this case we will use the Geolocation feature to block access from a couple countries only and only on the /downloads portion of the application, while access to <strong>www</strong> remains unaffected.</p>
<p><strong>Navigation:</strong> Security &gt; Network Firewall &gt; Policies, then click Create</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Name</strong></td>
<td>downloads_policy</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image321.png"><img alt="image30" src="../../_images/image321.png" style="width: 7.04167in; height: 1.70833in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Finished</p>
<p>Create an IP Drop Network Firewall Rule</p>
<p><strong>Navigation:</strong> Click Add</p>
<p><a class="reference internal" href="../../_images/image331.png"><img alt="image31" src="../../_images/image331.png" style="width: 7.04167in; height: 2.33333in;" /></a></p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">block_export_restricted_countries</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Order</strong></td>
<td>First</td>
</tr>
<tr class="row-odd"><td><strong>Protocol</strong></td>
<td>Any</td>
</tr>
<tr class="row-even"><td><strong>Source</strong></td>
<td>Country/Region: AF,CN,CA</td>
</tr>
<tr class="row-odd"><td><strong>Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image341.png"><img alt="image32" src="../../_images/image341.png" style="width: 7.05556in; height: 6.47222in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Finished</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">permit_log</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Order</strong></td>
<td>Last</td>
</tr>
<tr class="row-odd"><td><strong>Action</strong></td>
<td>Accept</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<p>Create Permit Log Network Firewall Rule</p>
<p><a class="reference internal" href="../../_images/image351.png"><img alt="image33" src="../../_images/image351.png" style="width: 7.04167in; height: 5.02778in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Finished</p>
<p><a class="reference internal" href="../../_images/image361.png"><img alt="image34" src="../../_images/image361.png" style="width: 7.04167in; height: 2.45833in;" /></a></p>
<p>From client machine try to connect again to the application site.</p>
<p>URL: <a class="reference external" href="https://www.mysite.com/downloads/">https://www.mysite.com/downloads/</a></p>
<p><a class="reference internal" href="../../_images/image371.png"><img alt="image35" src="../../_images/image371.png" style="width: 7.05556in; height: 3.30556in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We want to validate the site is available before and after applying the Network Firewall Policy</p>
</div>
</div>
<div class="section" id="assign-the-policy-to-the-virtual-server">
<h2>2.1.4.2. Assign The Policy To The Virtual Server<a class="headerlink" href="#assign-the-policy-to-the-virtual-server" title="Permalink to this headline">¶</a></h2>
<p>A unique feature of the BIG-IP Firewall Module allows L3-4 security policies to be assigned specifically to an application i.e. Virtual Server. So each application can have its own firewall policy separate from other application virtual servers.</p>
<p>Apply the Network Firewall Policy to Virtual Server</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Virtual Server</strong></th>
<th class="head">int_vip_www.mysite.com-downloads_1.1.1.3</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Enforcement</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td><strong>Policy</strong></td>
<td>downloads_policy</td>
</tr>
<tr class="row-even"><td><strong>Log Profile</strong></td>
<td>firewall_log_profile</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image381.png"><img alt="image36" src="../../_images/image381.png" style="width: 7.05556in; height: 6.91667in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Update</p>
<p>From client machine validate that you can still reach the application as you did in Lab3.</p>
<p>URL: <a class="reference external" href="https://www.mysite.com/downloads/">https://www.mysite.com/downloads/</a></p>
<p><a class="reference internal" href="../../_images/image371.png"><img alt="image37" src="../../_images/image371.png" style="width: 7.05000in; height: 3.30295in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We want to ensure the site is still available
after applying the policy. We will get into testing the block later.</p>
</div>
</div>
<div class="section" id="create-a-separate-policy-for-the-api-virtual-server">
<h2>2.1.4.3. Create A Separate Policy For The API Virtual Server<a class="headerlink" href="#create-a-separate-policy-for-the-api-virtual-server" title="Permalink to this headline">¶</a></h2>
<p>Now we want to create a second policy for access to the /api/
application</p>
<p>Create Network Firewall Policy</p>
<p><strong>Navigation:</strong> Security &gt; Network Firewall &gt; Policies, then click Create</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Name</strong></td>
<td>api_policy</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image391.png"><img alt="image38" src="../../_images/image391.png" style="width: 7.04167in; height: 1.75000in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Finished</p>
<p>Create Allow TCP Port 80 From Host 172.16.99.5 Network Firewall Rule</p>
<p><strong>Navigation:</strong> Click Add</p>
<p><a class="reference internal" href="../../_images/image401.png"><img alt="image39" src="../../_images/image401.png" style="width: 7.04167in; height: 2.50000in;" /></a></p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">allow_api_access</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Order</strong></td>
<td>First</td>
</tr>
<tr class="row-odd"><td><strong>Protocol</strong></td>
<td>TCP (6)</td>
</tr>
<tr class="row-even"><td><strong>Source</strong></td>
<td>Address: 172.16.99.5</td>
</tr>
<tr class="row-odd"><td><strong>Action</strong></td>
<td>Accept</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image411.png"><img alt="image40" src="../../_images/image411.png" style="width: 7.05556in; height: 6.86111in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Finished</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As we are deployed in “ADC Mode” where the default action on a virtual server is ‘Accept’, we must also create a default deny rule.</p>
</div>
<p>For further discussion of Firewall vs ADC modes, please consult the F5 BIG-IP documentation.</p>
<p><a class="reference external" href="https://support.f5.com/kb/en-us/products/big-ip-afm/manuals/product/network-firewall-policies-implementations-13-0-0/8.html">https://support.f5.com/kb/en-us/products/big-ip-afm/manuals/product/network-firewall-policies-implementations-13-0-0/8.html</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">deny_log</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Order</strong></td>
<td>Last</td>
</tr>
<tr class="row-odd"><td><strong>Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<p>Create Deny Log Network Firewall Rule</p>
<p><a class="reference internal" href="../../_images/image421.png"><img alt="image41" src="../../_images/image421.png" style="width: 7.04167in; height: 5.04167in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Finished</p>
<p>Apply the Network Firewall Policy to Virtual Server</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Virtual Server</strong></th>
<th class="head">int_vip_www.mysite.com-api_1.1.1.2</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Enforcement</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td><strong>Policy</strong></td>
<td>api_policy</td>
</tr>
<tr class="row-even"><td><strong>Log Profile</strong></td>
<td>firewall_log_profile</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../../_images/image431.png"><img alt="image42" src="../../_images/image431.png" style="width: 7.04167in; height: 6.33333in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Leave all other fields using the default values.</p>
</div>
<p><strong>Navigation:</strong> Click Update</p>
<p>From client machine</p>
<p>URL: <a class="reference external" href="https://www.mysite.com/api">https://www.mysite.com/api</a></p>
<p><a class="reference internal" href="../../_images/image441.png"><img alt="image43" src="../../_images/image441.png" style="width: 7.04167in; height: 4.19444in;" /></a></p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">You should no longer be able to access the /api site because the only allowed address is 172.16.99.5. You can verify this in the logs. What is the IP address that is trying to connect?</p>
</div>
<p><a class="reference internal" href="../../_images/image451.png"><img alt="image44" src="../../_images/image451.png" style="width: 7.04167in; height: 0.63889in;" /></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This concludes Module 1 - Lab 4</p>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="lab3.html" title="2.1.3. Lab 3: Configure Local Logging For Firewall Events" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab5.html" title="2.1.5. Lab 5: Provide Firewall Security Policies For CDN Enabled Applications" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>