<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>3.1.1. Base BIG-IP Configuration</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="3.1.1. Base BIG-IP Configuration"/>
  <meta name="product" content="F5 Firewall Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-01-28 09:36:45"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Firewall Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.1.1. Base BIG-IP Configuration &#8212; F5 Firewall Solutions  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.2. Module 2 – Detecting and Preventing System DoS and DDoS Attacks" href="../module2/module2.html" />
    <link rel="prev" title="3.1. Module 1 – Detecting and Preventing DNS DoS Attacks on a Virtual Server" href="module1.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Firewall Solutions  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">1. Class 1: AFM – The Data Center Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">2. Advanced Multi-Layer Firewall Protection</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class3.html">3. Class - F5 BIG-IP DDoS and DNS DoS Protections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">4. Flowmon Integrated Out-of-path DDoS Solution</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">3.1.1. Base BIG-IP Configuration</a></li>
<li><a class="reference internal" href="#detecting-and-preventing-dns-dos-attacks-on-a-virtual-server">3.1.2. Detecting and Preventing DNS DoS Attacks on a Virtual Server</a><ul>
<li><a class="reference internal" href="#establishing-a-dns-server-baseline">3.1.2.1. Establishing a DNS server baseline</a></li>
<li><a class="reference internal" href="#configuring-a-dos-logging-profile">3.1.2.2. Configuring a DoS Logging Profile</a></li>
<li><a class="reference internal" href="#configuring-a-dos-profile">3.1.2.3. Configuring a DoS Profile</a></li>
<li><a class="reference internal" href="#attaching-a-dos-profile">3.1.2.4. Attaching a DoS Profile</a></li>
<li><a class="reference internal" href="#simulate-a-dns-ddos-attack">3.1.2.5. Simulate a DNS DDoS Attack</a></li>
<li><a class="reference internal" href="#dns-ddos-mitigations-for-continued-service">3.1.2.6. DNS DDoS Mitigations for Continued Service</a><ul>
<li><a class="reference internal" href="#bad-actor-detection">3.1.2.6.1. Bad Actor Detection</a></li>
<li><a class="reference internal" href="#remote-triggered-black-holing">3.1.2.6.2. Remote Triggered Black Holing</a></li>
<li><a class="reference internal" href="#silverline-mitigation">3.1.2.6.3. Silverline Mitigation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#filtering-specific-dns-operations">3.1.3. Filtering specific DNS operations</a></li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Firewall Solutions</a>
              &gt; <a href="../class3.html">3. Class - F5 BIG-IP DDoS and DNS DoS Protections</a>
              &gt; <a href="module1.html">3.1. Module 1 – Detecting and Preventing DNS DoS Attacks on a Virtual Server</a>

          <span class="right">
             <a href="../../_sources/class3/module1/lab1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-firewall">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="base-big-ip-configuration">
<h1>3.1.1. Base BIG-IP Configuration<a class="headerlink" href="#base-big-ip-configuration" title="Permalink to this headline">¶</a></h1>
<p>In this lab, the VE has been configured with the basic system settings
and the VLAN/self-IP configurations required for the BIG-IP to
communicate and pass traffic on the network. We’ll now need to configure
the BIG-IP to listen for traffic and pass it to the back end server.</p>
<ol class="arabic">
<li><p class="first">Launch the Firefox shortcut titled <strong>Launch BIG-IP Web UI</strong> on the
desktop of your lab jump server. The credentials for the BIG-IP are
conveniently displayed in the login banner. Just in case: <strong>admin /
401elliottW!</strong></p>
</li>
<li><p class="first">Navigate to <strong>Local Traffic</strong> &gt; <strong>Nodes</strong> and create a new node with
the following settings, leaving unspecified fields at their default
value:</p>
<ol class="loweralpha">
<li><p class="first">Name: lab-server-10.10.0.50</p>
</li>
<li><div class="first line-block">
<div class="line">Address: 10.10.0.50</div>
<div class="line"><a class="reference internal" href="../../_images/image610.png"><img alt="image4" src="../../_images/image610.png" style="width: 3.94702in; height: 3.80739in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Click <strong>Finished</strong> to add the new node.</p>
</li>
<li><p class="first">Navigate to <strong>Local Traffic</strong> &gt; <strong>Pools</strong> and create a new pool with
the following settings, leaving unspecified attributes at their
default value:</p>
<ol class="loweralpha">
<li><p class="first">Name: lab-server-pool</p>
</li>
<li><p class="first">Health Monitors: gateway_icmp</p>
</li>
<li><p class="first">New Members: Node List
- Address: lab-server-10.10.0.50
- Service Port: * (All Ports)</p>
</li>
<li><div class="first line-block">
<div class="line">Click <strong>Add</strong> to add the new member to the member list.</div>
<div class="line"><a class="reference internal" href="../../_images/image711.png"><img alt="image5" src="../../_images/image711.png" style="width: 4.75828in; height: 4.42937in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Click <strong>Finished</strong> to create the new pool.</p>
</li>
<li><p class="first">Because the attack server will be sending a huge amount of traffic,
we’ll need a fairly large SNAT pool. Navigate to <strong>Local Traffic</strong> &gt;
<strong>Address Translation</strong> &gt; <strong>SNAT Pool List</strong> and create a new SNAT
pool with the following attributes:</p>
<ol class="loweralpha">
<li><p class="first">Name: inside_snat_pool</p>
</li>
<li><div class="first line-block">
<div class="line">Member List: 10.10.0.125, 10.10.0.126, 10.10.0.127, 10.10.0.128, 10.10.0.129, 10.10.0.130</div>
<div class="line"><a class="reference internal" href="../../_images/image810.png"><img alt="image6" src="../../_images/image810.png" style="width: 4.72535in; height: 3.47384in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Click <strong>Finished</strong> to commit your changes.</p>
</li>
<li><p class="first">Navigate to <strong>Local Traffic</strong> &gt; <strong>Virtual Servers</strong> and create a new
virtual server with the following settings, leaving unspecified
fields at their default value:</p>
<ol class="loweralpha">
<li><p class="first">Name: udp_dns_VS</p>
</li>
<li><p class="first">Destination Address/Mask: 10.20.0.10</p>
</li>
<li><p class="first">Service Port: 53</p>
</li>
<li><p class="first">Protocol: UDP</p>
</li>
<li><p class="first">Source Address Translation: SNAT</p>
</li>
<li><p class="first">SNAT Pool: inside_snat_pool</p>
</li>
<li><div class="first line-block">
<div class="line">Default Pool: lab-server-pool</div>
<div class="line"><a class="reference internal" href="../../_images/image910.png"><img alt="image7" src="../../_images/image910.png" style="width: 3.80731in; height: 8.22517in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Click <strong>Finished</strong>.</p>
</li>
<li><p class="first">We’ll now test the new DNS virtual server. SSH into the attack host
by clicking the “Attack Host (Ubuntu)” icon on the jump host
desktop.</p>
</li>
<li><p class="first">Issue the dig &#64;10.20.0.10
<a class="reference external" href="http://www.example.com">www.example.com</a> +short command on the
BASH CLI of the attack host. You should see output similar to:</p>
<p><a class="reference internal" href="../../_images/image1011.png"><img alt="image8" src="../../_images/image1011.png" style="width: 6.16667in; height: 0.44444in;" /></a></p>
<p>This verifies that DNS traffic is passing through the
BIG-IP.</p>
</li>
<li><p class="first">Return to the BIG-IP and navigate to <strong>Local Traffic</strong> &gt; <strong>Virtual
Servers</strong> and create a new virtual server with the following
settings, leaving unspecified fields at their default value:</p>
<ol class="loweralpha">
<li><p class="first">Name: other_protocols_VS</p>
</li>
<li><p class="first">Destination Address/Mask: 10.20.0.10</p>
</li>
<li><p class="first">Service Port: * (All Ports)</p>
</li>
<li><p class="first">Protocol: * All Protocols</p>
</li>
<li><p class="first">Any IP Profile: ipother</p>
</li>
<li><p class="first">Source Address Translation: SNAT</p>
</li>
<li><p class="first">SNAT Pool: inside_snat_pool</p>
</li>
<li><div class="first line-block">
<div class="line">Default Pool: lab-server-pool</div>
<div class="line"><a class="reference internal" href="../../_images/image1111.png"><img alt="image9" src="../../_images/image1111.png" style="width: 4.73472in; height: 6.05700in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Return to the Attack Host SSH session and attempt to SSH to the
server using SSH 10.20.0.10. Simply verify that you are prompted for
credentials and press CTRL+C to cancel the session. This verifies
that non-DNS traffic is now flowing through the BIG-IP.</p>
</li>
</ol>
</div>
<div class="section" id="detecting-and-preventing-dns-dos-attacks-on-a-virtual-server">
<h1>3.1.2. Detecting and Preventing DNS DoS Attacks on a Virtual Server<a class="headerlink" href="#detecting-and-preventing-dns-dos-attacks-on-a-virtual-server" title="Permalink to this headline">¶</a></h1>
<div class="section" id="establishing-a-dns-server-baseline">
<h2>3.1.2.1. Establishing a DNS server baseline<a class="headerlink" href="#establishing-a-dns-server-baseline" title="Permalink to this headline">¶</a></h2>
<p>Before we can attack our DNS server, we should establish a baseline for
how many QPS our DNS server can handle. For this lab, let’s find the
magic number of QPS that causes 50% CPU utilization on the BIND process.</p>
<ol class="arabic">
<li><p class="first">Connect to the Victim Server SSH session by double-clicking the
<strong>Victim Server (Ubuntu)</strong> shortcut on the jump host desktop.</p>
</li>
<li><p class="first">From the BASH prompt, enter <strong>top</strong> and press <strong>Enter</strong> to start the
top utility.</p>
</li>
<li><p class="first">You will see a list of running processes sorted by CPU utilization,
like the output below:</p>
<p><a class="reference internal" href="../../_images/image1211.png"><img alt="image10" src="../../_images/image1211.png" style="width: 5.60000in; height: 3.53333in;" /></a></p>
</li>
<li><p class="first">Connect to the Attack Host SSH session by double-clicking the
<strong>Attack Host (Ubuntu)</strong> shortcut on the jump host desktop.</p>
</li>
<li><div class="first line-block">
<div class="line">Start by sending 500 DNS QPS for 30 seconds to the host using the
following syntax:</div>
<div class="line">dnsperf -s 10.20.0.10 -d queryfile-example-current -c 20 -T 20 -l
30 -q 10000 -Q 500</div>
</div>
</li>
</ol>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">There is a text file on the desktop of the jump host with all of the CLI commands used in the lab for cut/paste use.</p>
</div>
<ol class="arabic" start="6">
<li><p class="first">Observe CPU utilization over the 30 second window for the <strong>named</strong>
process. If the CPU utilization is below 45%, increase the QPS by
increasing the -Q value. If the CPU utilization is above 55%,
decrease the QPS.</p>
</li>
<li><p class="first">Record the QPS required to achieve a sustained CPU utilization of
approximately 50%. Consider this the QPS that the server can safely
sustain for demonstration purposes.</p>
</li>
<li><div class="first line-block">
<div class="line">Now, attack the DNS server with 10,000 QPS using the following
syntax:</div>
<div class="line">dnsperf -s 10.20.0.10 -d queryfile-example-current -c 20 -T 20 -l
30 -q 10000 -Q 10000</div>
</div>
</li>
<li><p class="first">You’ll notice that the CPU utilization on the victim server
skyrockets, as well as DNS query timeout errors appearing on the
attack server’s SSH session. This shows your DNS server is
overwhelmed.</p>
</li>
</ol>
</div>
<div class="section" id="configuring-a-dos-logging-profile">
<h2>3.1.2.2. Configuring a DoS Logging Profile<a class="headerlink" href="#configuring-a-dos-logging-profile" title="Permalink to this headline">¶</a></h2>
<p>We’ll create a DoS logging profile so that we can see event logs in the
BIG-IP UI during attack mitigation.</p>
<ol class="arabic">
<li><p class="first">On the BIG-IP web UI, navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt;
<strong>Logging Profiles</strong> and create a new profile with the following
values, leaving unspecified attributes at their default value:</p>
<ol class="loweralpha">
<li><p class="first">Profile Name: dns-dos-profile-logging</p>
</li>
<li><p class="first">DoS Protection: Enabled</p>
</li>
<li><div class="first line-block">
<div class="line">DNS DoS Protection Publisher: local-db-publisher</div>
<div class="line"><a class="reference internal" href="../../_images/image139.png"><img alt="image11" src="../../_images/image139.png" style="width: 4.04500in; height: 5.58775in;" /></a></div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="configuring-a-dos-profile">
<h2>3.1.2.3. Configuring a DoS Profile<a class="headerlink" href="#configuring-a-dos-profile" title="Permalink to this headline">¶</a></h2>
<p>We’ll now create a DoS profile with manually configured thresholds to
limit the attack’s effect on our server.</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Navigate to <strong>Security</strong> &gt; <strong>DoS Protection</strong> &gt; <strong>DoS Profiles</strong>
and create a new DoS profile with the name <strong>dns-dos-profile</strong>.</div>
<div class="line"><a class="reference internal" href="../../_images/image142.png"><img alt="image12" src="../../_images/image142.png" style="width: 4.94444in; height: 2.29167in;" /></a></div>
</div>
</li>
<li><p class="first">The UI will return to the DoS Profiles list. Click the
<strong>dns-dos-profile</strong> name.</p>
</li>
<li><p class="first">Click the <strong>Protocol Security</strong> tab and select <strong>DNS Security</strong> from
the drop-down.</p>
</li>
<li><p class="first">Click the <strong>DNS A Query</strong> vector from the Attack Type list.</p>
</li>
<li><p class="first">Modify the <strong>DNS A Query</strong> vector configuration to match the
following values, leaving unspecified attributes with their default
value:</p>
<ol class="loweralpha">
<li><p class="first">State: Mitigate</p>
</li>
<li><p class="first">Threshold Mode: Fully Manual</p>
</li>
<li><p class="first">Detection Threshold EPS: (Set this at 80% of your safe QPS value)</p>
</li>
<li><div class="first line-block">
<div class="line">Mitigation Threshold EPS: (Set this to your safe QPS value)</div>
<div class="line"><a class="reference internal" href="../../_images/image151.png"><img alt="image13" src="../../_images/image151.png" style="width: 3.54305in; height: 4.68726in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Make sure that you click <strong>Update</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="section" id="attaching-a-dos-profile">
<h2>3.1.2.4. Attaching a DoS Profile<a class="headerlink" href="#attaching-a-dos-profile" title="Permalink to this headline">¶</a></h2>
<p>We’ll attach the DoS profile to the virtual server that we configured to
manage DNS traffic.</p>
<ol class="arabic simple">
<li>Navigate to <strong>Local Traffic</strong> &gt; <strong>Virtual Servers</strong> &gt; <strong>Virtual
Server List</strong>.</li>
<li>Click on the <strong>udp_dns_VS</strong> name.</li>
<li>Click on the <strong>Security</strong> tab and select <strong>Policies</strong>.</li>
<li>In the <strong>DoS Protection Profile</strong> field, select <strong>Enabled</strong> and
choose the <strong>dns-dos-profile</strong>.</li>
<li>In the <strong>Log Profile</strong>, select <strong>Enabled</strong> and move the
<strong>dns-dos-profile-logging</strong> profile from <strong>Available</strong> to
<strong>Selected</strong>.</li>
<li>Click <strong>Update</strong>.</li>
</ol>
</div>
<div class="section" id="simulate-a-dns-ddos-attack">
<h2>3.1.2.5. Simulate a DNS DDoS Attack<a class="headerlink" href="#simulate-a-dns-ddos-attack" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Open the SSH session to the victim server and ensure the top utility
is running.</p>
</li>
<li><div class="first line-block">
<div class="line">Once again, attack your DNS server from the attack host using the
following syntax:</div>
<div class="line">dnsperf -s 10.20.0.10 -d queryfile-example-current -c 20 -T 20 -l
30 -q 10000 -Q 10000</div>
</div>
</li>
<li><p class="first">On the server SSH session running the top utility, notice the CPU
utilization on your server remains in a range that ensures the DNS
server is not overwhelmed.</p>
</li>
<li><div class="first line-block">
<div class="line">After the attack, navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt;
<strong>DoS</strong> &gt; <strong>DNS Protocol</strong>. Observe the logs to see the mitigation
actions taken by the BIG-IP.</div>
<div class="line"><a class="reference internal" href="../../_images/image161.png"><img alt="image14" src="../../_images/image161.png" style="width: 6.50000in; height: 2.78542in;" /></a></div>
</div>
</li>
</ol>
</div>
<div class="section" id="dns-ddos-mitigations-for-continued-service">
<h2>3.1.2.6. DNS DDoS Mitigations for Continued Service<a class="headerlink" href="#dns-ddos-mitigations-for-continued-service" title="Permalink to this headline">¶</a></h2>
<p>At this point, you’ve successfully configured the BIG-IP to limit the
amount of resource utilization on the BIG-IP. Unfortunately, even valid
DNS requests can be caught in the mitigation we’ve configured. There are
further steps that can be taken to mitigate the attack that will allow
non-malicious DNS queries.</p>
<div class="section" id="bad-actor-detection">
<h3>3.1.2.6.1. Bad Actor Detection<a class="headerlink" href="#bad-actor-detection" title="Permalink to this headline">¶</a></h3>
<p>Bad actor detection and blacklisting allows us to completely block
communications from malicious hosts at the BIG-IP, completely preventing
those hosts from reaching the back-end servers. To demonstrate:</p>
<ol class="arabic">
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>DoS Protection</strong> &gt; <strong>DoS Profiles</strong>.</p>
</li>
<li><p class="first">Click on the <strong>dns-dos-profile</strong> profile name.</p>
</li>
<li><p class="first">Click on the <strong>Protocol Security</strong> tab then select <strong>DNS Security</strong>.</p>
</li>
<li><p class="first">Click on the <strong>DNS A Query</strong> attack type name.</p>
</li>
<li><p class="first">Modify the vector as follows:</p>
<ol class="loweralpha">
<li><p class="first">Bad Actor Detection: Checked</p>
</li>
<li><p class="first">Per Source IP Detection Threshold EPS: 80</p>
</li>
<li><p class="first">Per Source IP Mitigation Threshold EPS: 100</p>
</li>
<li><p class="first">Add Source Address to Category: Checked</p>
</li>
<li><p class="first">Category Name: denial_of_service</p>
</li>
<li><p class="first">Sustained Attack Detection Time: 15 seconds</p>
</li>
<li><div class="first line-block">
<div class="line">Category Duration Time: 60 seconds</div>
<div class="line"><a class="reference internal" href="../../_images/image172.png"><img alt="image15" src="../../_images/image172.png" style="width: 2.67129in; height: 5.81457in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Make sure you click <strong>Update</strong> to save your changes.</p>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Network Firewall</strong> &gt; <strong>IP
Intelligence</strong> &gt; <strong>Policies</strong> and create a new IP Intelligence
policy with the following values, leaving unspecified attributes at
their default values:</p>
<ol class="loweralpha">
<li><p class="first">Name: dns-bad-actor-blocking</p>
</li>
<li><p class="first">Default Log Actions section:</p>
<ol class="lowerroman simple">
<li>Log Blacklist Category Matches: Yes</li>
</ol>
</li>
<li><p class="first">Blacklist Matching Policy</p>
<ol class="lowerroman">
<li><p class="first">Create a new blacklist matching policy:</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Blacklist Category: denial_of_service</div>
<div class="line"><a class="reference internal" href="../../_images/image182.png"><img alt="image16" src="../../_images/image182.png" style="width: 6.22083in; height: 3.67500in;" /></a></div>
</div>
</li>
<li><p class="first">Click <strong>Add</strong> to add the policy.</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p class="first">Click <strong>Finished</strong>.</p>
</li>
<li><p class="first">Navigate to <strong>Local Traffic</strong> &gt; <strong>Virtual Servers</strong> &gt; <strong>Virtual
Server List</strong>.</p>
</li>
<li><p class="first">Click on the <strong>udp_dns_VS</strong> virtual server name.</p>
</li>
<li><p class="first">Click on the <strong>Security</strong> tab and select <strong>Policies</strong>.</p>
</li>
<li><div class="first line-block">
<div class="line">Enable <strong>IP Intelligence</strong> and choose the
<strong>dns-bad-actor-blocking</strong> policy.</div>
<div class="line"><a class="reference internal" href="../../_images/image192.png"><img alt="image17" src="../../_images/image192.png" style="width: 3.81074in; height: 5.31788in;" /></a></div>
</div>
</li>
<li><p class="first">Make sure you click <strong>Update</strong> to save your changes.</p>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt; <strong>Logging Profiles</strong>.</p>
</li>
<li><p class="first">Click the <strong>global-network</strong> logging profile name.</p>
</li>
<li><div class="first line-block">
<div class="line">Under the <strong>Network Firewall</strong> tab, set the IP Intelligence
Publisher to <strong>local-db-publisher</strong> and check <strong>Log Shun Events</strong>.</div>
<div class="line"><a class="reference internal" href="../../_images/image202.png"><img alt="image18" src="../../_images/image202.png" style="width: 4.17881in; height: 2.18072in;" /></a></div>
</div>
</li>
<li><p class="first">Click <strong>Update</strong> to save your changes.</p>
</li>
<li><p class="first">Click the <strong>dns-dos-profile-logging</strong> logging profile name.</p>
</li>
<li><div class="first line-block">
<div class="line">Check <strong>Enabled</strong> next to <strong>Network Firewall</strong>.</div>
<div class="line"><a class="reference internal" href="../../_images/image212.png"><img alt="image19" src="../../_images/image212.png" style="width: 3.40297in; height: 3.22001in;" /></a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Under the <strong>Network Firewall</strong> tab, change the <strong>Network
Firewall</strong> and <strong>IP Intelligence Publisher</strong> to
<strong>local-db-publisher</strong> and click <strong>Update</strong>.</div>
<div class="line"><a class="reference internal" href="../../_images/image222.png"><img alt="image20" src="../../_images/image222.png" style="width: 3.15278in; height: 3.98611in;" /></a></div>
</div>
</li>
<li><p class="first">Bring into view the Victim Server SSH session running the top
utility to monitor CPU utilization.</p>
</li>
<li><div class="first line-block">
<div class="line">On the Attack Server host, launch the DNS attack once again using
the following syntax:</div>
<div class="line">dnsperf -s 10.20.0.10 -d queryfile-example-current -c 20 -T 20 -l
30 -q 10000 -Q 10000</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">You’ll notice CPU utilization on the victim server begin to climb,
but slowly drop. The attack host will show that queries are timing
out as shown below. This is due to the BIG-IP blacklisting the bad
actor.</div>
<div class="line"><a class="reference internal" href="../../_images/image232.png"><img alt="image21" src="../../_images/image232.png" style="width: 2.36111in; height: 0.68056in;" /></a></div>
</div>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt; <strong>Network</strong> &gt; <strong>IP
Intelligence</strong>. Observe the bad actor blocking mitigation logs.</p>
</li>
<li><div class="first line-block">
<div class="line">Navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt; <strong>Network</strong> &gt;
<strong>Shun</strong>. This screen shows the bad actor being added to (and
later deleted from) the shun category.</div>
<div class="line"><a class="reference internal" href="../../_images/image242.png"><img alt="image22" src="../../_images/image242.png" style="width: 4.87500in; height: 1.68056in;" /></a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Navigate to <strong>Security</strong> &gt; <strong>Reporting</strong> &gt; <strong>Protocol</strong> &gt; <strong>DNS</strong>.
Change the <strong>View By</strong> drop-down to view various statistics around
the DNS traffic and attacks.</div>
<div class="line"><a class="reference internal" href="../../_images/image252.png"><img alt="image23" src="../../_images/image252.png" style="width: 4.32450in; height: 3.69594in;" /></a></div>
</div>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Reporting</strong> &gt; <strong>Network</strong> &gt; <strong>IP
Intelligence</strong>. The default view may be blank. Change the <strong>View
By</strong> drop-down to view various statistics around the IP Intelligence
handling of the attack traffic.</p>
</li>
<li><div class="first line-block">
<div class="line">Navigate to <strong>Security</strong> &gt; <strong>Reporting</strong> &gt; <strong>DoS</strong> &gt; <strong>Dashboard</strong>
to view an overview of the DoS attacks and timeline. You can
select filters in the filter pane to highlight specific attacks.</div>
<div class="line"><a class="reference internal" href="../../_images/image262.png"><img alt="image24" src="../../_images/image262.png" style="width: 5.00000in; height: 4.06944in;" /></a></div>
</div>
</li>
<li><p class="first">Finally, navigate to <strong>Security</strong> &gt; <strong>Reporting</strong> &gt; <strong>DoS</strong> &gt;
<strong>Analysis</strong>. View detailed statistics around each attack.</p>
</li>
</ol>
</div>
<div class="section" id="remote-triggered-black-holing">
<h3>3.1.2.6.2. Remote Triggered Black Holing<a class="headerlink" href="#remote-triggered-black-holing" title="Permalink to this headline">¶</a></h3>
<p>The BIG-IP supports the advertisement of bad actor(s) to upstream
devices via BGP to block malicious traffic closer to the source. This is
accomplished by publishing a blacklist to an external resource. This is
not demonstrated in this lab.</p>
</div>
<div class="section" id="silverline-mitigation">
<h3>3.1.2.6.3. Silverline Mitigation<a class="headerlink" href="#silverline-mitigation" title="Permalink to this headline">¶</a></h3>
<p>F5’s cloud-based scrubbing service Silverline offers “always on” and “on demand” DDoS scrubbing that could
assist in this scenario as well. This is not demonstrated in this lab.</p>
</div>
</div>
</div>
<div class="section" id="filtering-specific-dns-operations">
<h1>3.1.3. Filtering specific DNS operations<a class="headerlink" href="#filtering-specific-dns-operations" title="Permalink to this headline">¶</a></h1>
<p>The BIG-IP offers the ability to filter DNS query types and header
opcodes to act as a DNS firewall. To demonstrate, we will block MX
queries from our DNS server.</p>
<ol class="arabic">
<li><p class="first">Open the SSH session to the attack host.</p>
</li>
<li><div class="first line-block">
<div class="line">Perform an MX record lookup by issuing the following command:</div>
<div class="line">dig &#64;10.20.0.10 MX example.com</div>
</div>
</li>
<li><p class="first">The server doesn’t have a record for this domain. This server
doesn’t have MX records, so those requests should be filtered</p>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Protocol Security</strong> &gt; <strong>Security
Profiles</strong> &gt; <strong>DNS</strong> and create a new DNS security profile with the
following values, leaving unspecified attributes at their default
value:</p>
<ol class="loweralpha">
<li><p class="first">Name: dns-block-mx-query</p>
</li>
<li><div class="first line-block">
<div class="line">Query Type Filter: move mx from Available to Active</div>
<div class="line"><a class="reference internal" href="../../_images/image272.png"><img alt="image25" src="../../_images/image272.png" style="width: 3.89968in; height: 3.43639in;" /></a></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Navigate to <strong>Local Traffic</strong> &gt; <strong>Profiles</strong> &gt; <strong>Services</strong> &gt;
<strong>DNS</strong>. <strong>NOTE:</strong> if you are mousing over the services, DNS may not
show up on the list. Select <strong>Services</strong> and then use the pulldown
menu on services to select <strong>DNS</strong>.</p>
</li>
<li><p class="first">Create a new DNS services profile with the following values, leaving
unspecified values at their default values:</p>
<ol class="loweralpha">
<li><p class="first">Name: dns-block-mx</p>
</li>
<li><p class="first">DNS Traffic</p>
<ol class="lowerroman">
<li><p class="first">DNS Security: Enabled</p>
</li>
<li><div class="first line-block">
<div class="line">DNS Security Profile Name: dns-block-mx-query</div>
<div class="line"><a class="reference internal" href="../../_images/image282.png"><img alt="image26" src="../../_images/image282.png" style="width: 2.60017in; height: 6.93378in;" /></a></div>
</div>
</li>
</ol>
</li>
</ol>
</li>
<li><p class="first">Navigate to <strong>Local Traffic</strong> &gt; <strong>Virtual Servers</strong> &gt; <strong>Virtual
Server List</strong>.</p>
</li>
<li><p class="first">Click on the <strong>udp_dns_VS</strong> virtual server name.</p>
</li>
<li><p class="first">In the <strong>Configuration</strong> section, change the view to <strong>Advanced</strong>.</p>
</li>
<li><div class="first line-block">
<div class="line">Set the <strong>DNS Profile</strong> to <strong>dns-block-mx</strong>.</div>
<div class="line"><a class="reference internal" href="../../_images/image292.png"><img alt="image27" src="../../_images/image292.png" style="width: 3.02244in; height: 2.63576in;" /></a></div>
</div>
</li>
<li><p class="first">Click <strong>Update</strong> to save your settings.</p>
</li>
<li><p class="first">Navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt; <strong>Logging Profiles</strong>.</p>
</li>
<li><p class="first">Click on the <strong>dns-dos-profile-logging</strong> logging profile name.</p>
</li>
<li><p class="first">Check <strong>Enabled</strong> next to <strong>Protocol Security</strong>.</p>
</li>
<li><div class="first line-block">
<div class="line">In the <strong>Protocol Security</strong> tab, set the <strong>DNS Security
Publisher</strong> to local-db-publisher and check all five of the
request log types.</div>
<div class="line"><a class="reference internal" href="../../_images/image302.png"><img alt="image28" src="../../_images/image302.png" style="width: 3.19205in; height: 5.75689in;" /></a></div>
</div>
</li>
<li><p class="first">Make sure that you click <strong>Update</strong> to save your settings.</p>
</li>
<li><div class="first line-block">
<div class="line">Return to the Attack Server SSH session and re-issue the MX query
command:</div>
<div class="line">dig &#64;10.20.0.10 MX example.com</div>
</div>
</li>
<li><p class="first">The query hangs as the BIG-IP is blocking the MX lookup.</p>
</li>
<li><div class="first line-block">
<div class="line">Navigate to <strong>Security</strong> &gt; <strong>Event Logs</strong> &gt; <strong>Protocol</strong> &gt;
<strong>DNS</strong>. Observer the MX query drops.</div>
<div class="line"><a class="reference internal" href="../../_images/image311.png"><img alt="image29" src="../../_images/image311.png" style="width: 3.80132in; height: 1.11928in;" /></a></div>
</div>
</li>
</ol>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">This concludes the DNS portion of the lab. On the victim server, stop the top utility by pressing <strong>CTRL + C</strong>.</p>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="module1.html" title="3.1. Module 1 – Detecting and Preventing DNS DoS Attacks on a Virtual Server" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="../module2/module2.html" title="3.2. Module 2 – Detecting and Preventing System DoS and DDoS Attacks" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>